using Azure.Identity;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Server.Service.Customers;
using Shared.Models;

namespace Server.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class CustomersController : ControllerBase
    {
        public ICustomersService service { get; set; }
        public CustomersController(ICustomersService service)
        {
            this.service = service;
        }

        [HttpGet("getcustomers")]
        public async Task<ActionResult<List<Customer>>> GetCustomersAsync() 
        {
            var lista = await service.GetCustomersAsync();
            return Ok(lista);
        }

        [HttpGet("getcustomerbyid/{id}")]
        public async Task<ActionResult<Customer>> GetCustomerByIdAsync(int id) 
        {
            var customer = await service.GetCustomerByIdAsync(id);
            return customer is null ? NotFound() : Ok(customer);
        }

        [HttpPost("createcustomer")]
        public async Task<ActionResult<Customer>> CreateCustomerAsync([FromBody] Customer customer) 
        {
            var created = await service.CreateCustomerAsync(customer);
            return CreatedAtAction(nameof(GetCustomerByIdAsync), new { id = customer.CustomerId }, created);
        }

        [HttpPut("updatecustomer/{id}")]
        public async Task<ActionResult<Customer>> UpdateCustomerAsync(int id, [FromBody] Customer customer) 
        {
            var updated = await service.UpdateCustomerAsync(id, customer);
            return updated is null ? NotFound() : Ok(updated);
        }

        [HttpDelete("deleteproduct/{id}")]
        public async Task<ActionResult> DeleteCustomerAsync(int id) 
        {
            var ok = await service.DeleteCustomerAsync(id);
            return ok ? NoContent() : NotFound();
        }




    }
}
